{% extends "layout.html" %}

{% block title %}Gestion des cam√©ras - SmartCam{% endblock %}

{% block content %}
<div class="cameras-page">
    <div class="page-header">
        <h2>Gestion des cam√©ras</h2>
    <button class="btn btn-primary" id="addCameraBtn">‚ûï Ajouter une cam√©ra</button>
    </div>

    <div class="filters">
        <label>
            Filtrer par statut :
            <select id="statusFilter">
                <option value="">Tous</option>
                <option value="active">Active</option>
                <option value="inactive">Inactive</option>
                <option value="maintenance">Maintenance</option>
                <option value="error">Erreur</option>
            </select>
        </label>
    </div>

    <div class="cameras-grid">
        {% if cameras.length > 0 %}
            {% for camera in cameras %}
            <div class="camera-card" data-status="{{ camera.status }}">
                <a href="/cameras/{{ camera.id }}" class="camera-link">
                    <div class="camera-header">
                        <h3>Cam√©ra #{{ camera.id }}</h3>
                        <span class="status-badge {{ camera.status }}">{{ camera.status }}</span>
                    </div>
                    <div class="camera-info">
                        <p><strong>IP:</strong> {{ camera.ip }}</p>
                        <p><strong>Mod√®le:</strong> {{ camera.model | default('Non sp√©cifi√©') }}</p>
                        <p><strong>Derni√®re connexion:</strong> 
                            {% if camera.last_connexion %}
                                {{ camera.last_connexion }}
                            {% else %}
                                Jamais
                            {% endif %}
                        </p>
                        {% if camera.status == 'error' %}
                        <p class="error-message">‚ö†Ô∏è Cam√©ra inaccessible - Erreur de connexion</p>
                        {% endif %}
                    </div>
                </a>
                <div class="camera-actions">
                    {% if camera.status == 'active' %}
                        <button class="btn btn-warning btn-stop" data-id="{{ camera.id }}">‚è∏Ô∏è Arr√™ter</button>
                    {% else %}
                        <button class="btn btn-success btn-start" data-id="{{ camera.id }}">‚ñ∂Ô∏è D√©marrer</button>
                    {% endif %}
                    <button class="btn btn-secondary btn-edit" data-id="{{ camera.id }}">‚úèÔ∏è Modifier</button>
                    <button class="btn btn-danger btn-delete" data-id="{{ camera.id }}">üóëÔ∏è Supprimer</button>
                </div>
            </div>
            {% endfor %}
        {% else %}
            <p class="no-data">Aucune cam√©ra enregistr√©e. Ajoutez-en une pour commencer.</p>
        {% endif %}
    </div>
</div>

<!-- Modal pour ajouter/modifier une cam√©ra -->
<div id="cameraModal" class="modal">
    <div class="modal-content">
    <span class="close" id="closeModalBtn">&times;</span>
        <h3 id="modalTitle">Ajouter une cam√©ra</h3>
    <form id="cameraForm">
            <input type="hidden" id="cameraId" name="id">
            
            <div class="form-group">
                <label for="ip">Adresse IP *</label>
                <input type="text" id="ip" name="ip" required placeholder="192.168.1.100">
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="port">Port</label>
                    <input type="number" id="port" name="port" min="1" max="65535" value="554" placeholder="554">
                    <small>Port RTSP (d√©faut: 554)</small>
                </div>
                
                <div class="form-group">
                    <label for="path">Chemin du flux</label>
                    <input type="text" id="path" name="path" value="/live0" placeholder="/live0">
                    <small>Chemin de l'URI (ex: /live0, /Streaming/Channels/101)</small>
                </div>
            </div>
            
            <div class="form-group">
                <label for="username">Nom d'utilisateur *</label>
                <input type="text" id="username" name="username" required placeholder="admin">
            </div>
            
            <div class="form-group">
                <label for="password">Mot de passe *</label>
                <input type="password" id="password" name="password" required>
            </div>
            
            <div class="form-group">
                <label for="model">Mod√®le</label>
                <input type="text" id="model" name="model" placeholder="Hikvision DS-2CD2142FWD-I">
            </div>

            <h4 style="margin-top: 20px; margin-bottom: 10px; color: #333;">Position GPS</h4>
            
            <div class="form-group">
                <label for="latitude">Latitude *</label>
                <input type="number" id="latitude" name="latitude" step="0.00000001" required placeholder="46.519653">
                <small>Format: d√©cimal (ex: 46.519653)</small>
            </div>
            
            <div class="form-group">
                <label for="longitude">Longitude *</label>
                <input type="number" id="longitude" name="longitude" step="0.00000001" required placeholder="6.632273">
                <small>Format: d√©cimal (ex: 6.632273)</small>
            </div>
            
            <div class="form-group">
                <label for="label">Libell√© de la position</label>
                <input type="text" id="label" name="label" placeholder="Entr√©e principale">
                <small>Description de l'emplacement (optionnel)</small>
            </div>
            
            <div class="form-actions">
                <button type="button" class="btn btn-secondary" id="cancelModalBtn">Annuler</button>
                <button type="submit" class="btn btn-primary">Enregistrer</button>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="/js/cameras.js"></script>
{% endblock %}
