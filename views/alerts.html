{% extends "layout.html" %}

{% block title %}Alertes - SmartCam{% endblock %}

{% block content %}
<div class="alerts-page">
    <h2>Gestion des alertes</h2>

    <div class="filters">
        <label>
            Type d'intervention :
            <select id="typeFilter">
                <option value="">Tous</option>
                <option value="Police">üöî Police</option>
                <option value="Pompier">üöí Pompiers</option>
                <option value="Ambulance">üöë Ambulance</option>
            </select>
        </label>
        
        <label>
            Statut :
            <select id="statusFilter">
                <option value="false">Non r√©solues</option>
                <option value="true">R√©solues</option>
                <option value="">Toutes</option>
            </select>
        </label>
        
        <label>
            V√©rification :
            <select id="verificationFilter">
                <option value="">Toutes</option>
                <option value="true">V√©rifi√©es</option>
                <option value="false">Non v√©rifi√©es</option>
            </select>
        </label>
    </div>

    {% if alerts.length > 0 %}
    <div class="alerts-list">
        {% for alert in alerts %}
        <div class="alert-item {{ alert.severity }}" data-type="{{ alert.type_analyse }}" data-resolved="{{ alert.is_resolved }}" data-verified="{{ alert.human_verification }}">
            <a href="/alerts/{{ alert.id }}" class="alert-link-wrapper">
                <div class="alert-icon">
                    {% if alert.type_analyse == 'Police' %}üöî
                    {% elif alert.type_analyse == 'Pompier' %}üöí
                    {% elif alert.type_analyse == 'Ambulance' %}üöë
                    {% endif %}
                </div>
                <div class="alert-content">
                    <div class="alert-header">
                        <h3>{{ alert.analysis_name }}</h3>
                        <span class="alert-time">{{ alert.date | date('DD/MM/YYYY HH:mm:ss') }}</span>
                    </div>
                    <div class="alert-details">
                        <p><strong>Cam√©ra:</strong> {{ alert.camera_ip }}</p>
                        <p><strong>Gravit√©:</strong> <span class="severity {{ alert.severity }}">{{ alert.severity }}</span></p>
                            <p><strong>Confiance:</strong> {{ (alert.confidence * 100) | round(1, 'common') }}%</p>
                        <p><strong>R√©sultat:</strong> <span class="result {{ alert.result }}">{{ alert.result }}</span></p>
                    </div>
                    <div class="alert-status">
                        {% if alert.is_resolved %}
                            <span class="badge resolved">‚úì R√©solue</span>
                        {% else %}
                            <span class="badge unresolved">‚è≥ Non r√©solue</span>
                        {% endif %}
                        
                        {% if alert.human_verification %}
                            <span class="badge verified">‚úì V√©rifi√©e</span>
                        {% else %}
                            <span class="badge unverified">‚ö†Ô∏è Non v√©rifi√©e</span>
                        {% endif %}
                    </div>
                </div>
            </a>
            <div class="alert-actions">
                <button class="btn btn-sm btn-image" data-id="{{ alert.fk_image }}">üñºÔ∏è Image</button>
                {% if not alert.human_verification %}
                    <button class="btn btn-sm btn-primary btn-verify" data-id="{{ alert.id }}" data-verify="true">‚úì V√©rifier</button>
                    <button class="btn btn-sm btn-secondary btn-verify" data-id="{{ alert.id }}" data-verify="false">‚úó Rejeter</button>
                {% endif %}
                {% if not alert.is_resolved %}
                    <button class="btn btn-sm btn-success btn-resolve" data-id="{{ alert.id }}">‚úì R√©soudre</button>
                {% endif %}
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <p class="no-data">Aucune alerte trouv√©e.</p>
    {% endif %}
</div>

<!-- Modal pour afficher l'image -->
<div id="imageModal" class="modal">
    <div class="modal-content modal-image">
    <span class="close" id="closeImageModalBtn">&times;</span>
        <img id="alertImage" src="" alt="Image de l'alerte">
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="/js/alerts.js"></script>
{% endblock %}
